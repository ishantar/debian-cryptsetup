This is the documentation for implementing a robust check system into
/etc/init.d/cryptdisks

checks marked with [default] should always be enabled.

basic ideas:
 - default checks are only necessary where one of OUR actions causes
   dataloss.
 - our checks must not cause any modifications to the underlying device.
 - it should be possible to deactivate all default checks with options
   in crypttab.

The only default checks which apply to all situations are:
 * precheck: does the source device exist? [default]
 * check: does the target device contain a known filesystem [default]

Currently, three different branches exist:

### swap ###
 - luks and a /dev/*random key are not compatible. disable this combination
 * precheck:
   - is the source device a swap partition? [not implemented yet]
 * postcheck:
   - contains the target device a swap filesystem [default]

note to swap: It's the users fault to mark a partition with type swap.
              Every live-cd will format partitions with type swap.

### plain dm-crypt ###
 * precheck:
   - check for all known filesystems on the device [not implemented yet]
     + true: abort
 * postcheck:
   - check what the user requested us to check [filesystem, lvm, ...]
     + false: remove the dm-crypt device, retry as often as configured

note to plain dm-crypt: The postcheck (for filesystem or whatever) is the only
                        way to verify that the given password/key is correct.

### luks ###
 * precheck:
   - check whether the device is a LUKS partition [default]
     + false: abort
 * postcheck:
   - check what the user requested us to check [filesystem, lvm, ...]
     + false: just print a warning, the right password has been supplied
