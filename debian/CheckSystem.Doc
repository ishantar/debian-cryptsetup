This is the documentation for implementing a robust
check system into /etc/init.d/cryptdisks

checks marked with [default] should always be enabled.

basic ideas:
 - default checks are only necessary where one of OUR actions causes
   dataloss.
 - our checks must not cause any modifications to the underlying device.
 - it should be possible to decativate all default checks with options
   in crypttab.

The only default check which applies to all situations is:
 * precheck: does the source device exist? [default]

Currently, three different branches exist:

### swap ###
 - luks and swap is not compatible, thus disable this combination
 * precheck:
   - is the device a physical partition with type 'swap' (id 82)? [default]
     + false: check for all known filesystems on the device
       + true: abort
   - maybe a check for suspend/resume (there are reported problems
     with some of this on grml, but are not restricted to grml) [?default?]
 * postcheck: useless

note to swap: It's the users fault to mark a partition with type swap.
              Every live-cd will format partitions with type swap.

### plain dm-crypt ###
 * precheck:
   - check for all known filesystems on the device
     + true: abort
 * postcheck:
   - check what the user requested us to check [filesystem, lvm, ...]
     + false: remove the dm-crypt device, retry as often as configured

note to plain dm-crypt: The postcheck (for filesystem or whatever) is the only
                        way to verify that the given password/key is correct.

### luks ###
 * precheck:
   - check whether the device is a LUKS partition [default]
     + false: abort
 * postcheck:
   - check what the user requested us to check [filesystem, lvm, ...]
     + false: just print a warning, the right password has been supplied.
